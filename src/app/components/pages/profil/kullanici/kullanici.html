<pre style="position:fixed;bottom:80px;right:16px;color:#fff;opacity:.6">
  sendOk={{sendOk}} tab={{activeTab}}
</pre>

<div class="page">
  <section class="card">
    <!-- Header -->
    <header class="header">
      <button class="back" (click)="goBack()" aria-label="Geri">âŸµ</button>
      <h1 class="sr-only">KullanÄ±cÄ± Profili</h1>
    </header>

    <!-- Profil Ã¼st blok -->
    <div class="profile">
      <div class="avatar"><span class="initial">{{ initialLetter }}</span></div>
      <div class="username-pill">{{ displayName }}</div>
      <div class="city">{{ user.city }}</div>
      <div class="rating">
        <span>â˜…</span> {{ user.ratingAvg ?? 0 }}
        <small>({{ user.ratingCount ?? 0 }})</small>
      </div>
    </div>

    <!-- Tabs -->
    <nav class="tabs">
      <button [class.active]="activeTab==='rozetler'" (click)="setTab('rozetler')">Rozetler</button>
      <button [class.active]="activeTab==='yorumlar'" (click)="setTab('yorumlar')">Yorumlar &amp; Puanlama</button>
      <button [class.active]="activeTab==='mesaj'" (click)="setTab('mesaj')">Mesaj GÃ¶nder</button>
    </nav>

    <!-- Ä°Ã§erik -->
    <section class="content">

      <!-- ROZETLER -->
      <div *ngIf="activeTab==='rozetler'">
        <div class="badge-row">
          <div class="badge" *ngFor="let b of badges" [title]="b.name">
            <div class="icon">{{ b.icon }}</div>
            <div class="label">{{ b.name }}</div>
          </div>
        </div>
      </div>

      <!-- YORUMLAR & PUANLAMA -->
      <div *ngIf="activeTab==='yorumlar'" class="mt-3">

        <!-- PUAN VERME (kendine kapalÄ±) -->
        <div *ngIf="meId !== userId" class="comment-card mb-3">
          <div class="card-body d-flex flex-wrap align-items-center gap-3">
            <div class="fw-semibold me-2">Bu kullanÄ±cÄ±yÄ± puanla:</div>

            <div class="stars" role="radiogroup" aria-label="Puan">
              <button type="button"
                      class="star-btn"
                      *ngFor="let s of [1,2,3,4,5]"
                      [class.on]="s <= myScore"
                      (click)="setScore(s)"
                      [attr.aria-pressed]="s <= myScore">â˜…</button>
            </div>

            <button class="btn btn-success ms-auto"
                    [disabled]="isRatingSending || myScore===0"
                    (click)="sendRating()">
              PuanÄ± GÃ¶nder
            </button>

            <span class="text-muted small ms-2">
              Ortalama: {{ (user.ratingAvg || 0) | number:'1.1-2' }} ({{ user.ratingCount || 0 }})
            </span>
          </div>
        </div>

        <!-- YORUM YAZ (kendine kapalÄ±) -->
        <div *ngIf="meId !== userId" class="comment-card mb-3">
          <div class="card-body">
            <label class="form-label fw-semibold">Yorum yaz</label>
            <textarea class="form-control" rows="3"
                      [disabled]="isCommentSending"
                      (input)="onCommentInput($event)"
                      (keydown.control.enter)="sendComment()"
                      placeholder="DÃ¼ÅŸÃ¼nceni yaz (Ctrl/Cmd + Enter ile gÃ¶nder)"></textarea>

            <div class="d-flex align-items-center gap-2 mt-2">
              <button class="btn btn-primary"
                      [disabled]="isCommentSending || !commentText.trim()"
                      (click)="sendComment()">
                GÃ¶nder
              </button>
              <span *ngIf="commentSendOk" class="text-success small">Yorum gÃ¶nderildi.</span>
            </div>
          </div>
        </div>

        <!-- YORUM LÄ°STESÄ° -->
        <div *ngIf="isCommentsLoading" class="text-muted">Yorumlar yÃ¼kleniyorâ€¦</div>
        <div *ngIf="!isCommentsLoading && comments.length === 0" class="text-muted">HenÃ¼z yorum yok.</div>

        <div class="list-group" *ngIf="!isCommentsLoading && comments.length > 0">
          <div class="list-group-item bg-transparent border-0 p-0 mb-3"
               *ngFor="let c of comments">
            <div class="comment-card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <strong>{{ c.authorName }}</strong>
                  <small class="text-muted">{{ c.createdAt | date:'short' }}</small>
                </div>
                <div class="mt-2">{{ c.content }}</div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- MESAJ (kendine kapalÄ±) -->
      <div *ngIf="activeTab==='mesaj'">
        <div *ngIf="meId !== userId && showComposer" class="message-box">
          <textarea
            id="mesajTextarea"
            [value]="messageText"
            (input)="onMessageInput($event)"
            (keydown.enter)="sendMessage()"
            placeholder="Mesaj yaz..."></textarea>

          <button class="primary"
                  (click)="sendMessage()"
                  [disabled]="!messageText.trim() || isSending">
            MESAJ GÃ–NDER
          </button>
        </div>

        <button *ngIf="meId !== userId && sendOk && !showComposer"
                class="primary"
                (click)="newMessage()">
          ðŸŽ‰ MesajÄ±nÄ±z gÃ¶nderildi
        </button>
      </div>

    </section>
  </section>
</div>
