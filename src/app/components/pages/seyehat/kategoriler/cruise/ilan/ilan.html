<div class="create-wrapper">

  <!-- ===== Başlık ===== -->
  <div class="pill">Etkinlik Başlığı</div>
  <div class="title-panel">
    <input
      class="title-input"
      type="text"
      [value]="title"
      [attr.maxlength]="maxTitleLen"
      required
      placeholder="Etkinlik başlığını girin"
      aria-describedby="titleCount"
      [attr.aria-invalid]="titleInvalid"
      (blur)="titleTouched = true"
      (input)="onTitleChange($event)"
      [class.invalid]="titleInvalid"
    />
    <div id="titleCount" class="counter">{{ titleLen }}/{{ maxTitleLen }}</div>

    @if (titleInvalid) {
      <div class="error">Başlık zorunludur.</div>
    }
  </div>

  <!-- ===== Açıklama ===== -->
  <div class="pill" style="margin-top: 14px;">Açıklama</div>
  <div class="title-panel">
    <textarea
      class="title-input"
      rows="5"
      [value]="description"
      [attr.maxlength]="maxDescLen"
      placeholder="Etkinlik açıklamasını yazın"
      aria-describedby="descCount"
      [attr.aria-invalid]="descInvalid"
      (blur)="descriptionTouched = true"
      (input)="onDescChange($event)"
      [class.invalid]="descInvalid"
    ></textarea>
    <div id="descCount" class="counter">{{ descLen }}/{{ maxDescLen }}</div>

    @if (descInvalid) {
      <div class="error">Açıklama zorunludur.</div>
    }
  </div>

  <!-- ===== Konum: Şehir ===== -->
  <div class="pill" style="margin-top: 14px;">Şehir</div>
  <div class="title-panel">
    <input
      class="title-input"
      type="text"
      [value]="cityInput"
      placeholder="Şehir yaz veya seç (örn: Ankara)"
      (input)="onCityInputChange($event)"
    />

    @if (cityOptions.length > 0) {
      <ul class="dropdown">
        @for (c of cityOptions; track c.id) {
          <li class="dropdown-item" (click)="selectCity(c)">
            {{ c.name }}
          </li>
        }
      </ul>
    }

    @if (cityInput || selectedCityId) {
      <button type="button" class="clear-btn" (click)="clearCity()">Temizle</button>
    }
  </div>

  <!-- ===== Konum: İlçe ===== -->
  <div class="pill" style="margin-top: 14px;">İlçe</div>
  <div class="title-panel">
    <input
      class="title-input"
      type="text"
      [value]="districtInput"
      [disabled]="!selectedCityId && cityOptions.length === 0 && !cityInput"
      placeholder="İlçe yaz veya seç"
      (input)="onDistrictInputChange($event)"
    />

    @if (districtOptions.length > 0) {
      <ul class="dropdown">
        @for (d of districtOptions; track d.id) {
          <li class="dropdown-item" (click)="selectDistrict(d)">
            {{ d.name }}
          </li>
        }
      </ul>
    }

    @if (districtInput || selectedDistrictId) {
      <button type="button" class="clear-btn" (click)="clearDistrict()">Temizle</button>
    }
  </div>

  <!-- ===== Tarih ===== -->
  <div class="pill" style="margin-top: 14px;">Tarih</div>

  <!-- 1) Native tarih seçici -->
  <div class="title-panel">
    <input
      class="title-input"
      type="date"
      [attr.min]="minDate"
      [value]="eventDate"
      (input)="onDateInputChange($event)"
    />

    @if (dateInvalid) {
      <div class="error">Geçmiş tarih seçilemez.</div>
    }
  </div>

  <!-- 2) Dropdown tarih seçici -->
  <div class="title-panel" style="margin-top: 10px;">
    <div class="triple-row">
      <select class="title-input" (change)="onYearSelect(+$any($event.target).value)">
        <option value="">Yıl seç</option>
        @for (y of years; track y) {
          <option [value]="y">{{ y }}</option>
        }
      </select>

      <select class="title-input" [disabled]="!selectedYear" (change)="onMonthSelect(+$any($event.target).value)">
        <option value="">Ay seç</option>
        @for (m of months; track m.id) {
          <option [value]="m.id">{{ m.name }}</option>
        }
      </select>

      <select class="title-input" [disabled]="!selectedMonth" (change)="onDaySelect(+$any($event.target).value)">
        <option value="">Gün seç</option>
        @for (d of days; track d) {
          <option [value]="d">{{ d }}</option>
        }
      </select>
    </div>

    @if (eventDate) {
      <div class="hint">Seçilen tarih: {{ eventDate }}</div>
    }
    @if (dateInvalid) {
      <div class="error">Geçmiş tarih seçilemez.</div>
    }
  </div>

  <!-- ===== Submit: Bul Beni ===== -->
  <div class="actions">
    <button
      type="button"
      class="primary-btn"
      (click)="onSubmit()"
      [disabled]="submitting || !formValid"
      aria-label="Bul Beni - ilanı kaydet"
    >
      Bul Beni
    </button>
  </div>

  <!-- ===== Sonuç / Hata ===== -->
  @if (createdId) {
    <div class="result">✅ İlan oluşturuldu. ID: {{ createdId }}</div>
  }
  @if (submitError) {
    <div class="error">❌ {{ submitError }}</div>
  }

</div>
