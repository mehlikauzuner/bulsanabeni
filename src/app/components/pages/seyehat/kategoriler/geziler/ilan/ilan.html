

<div class="create-wrapper" *ngIf="ilan[0] as m">

  <!-- Kullanıcı (opsiyonel) -->
  <div class="user-bar">
    <div class="avatar"><span>{{ (m.User.fullName || 'U').charAt(0) }}</span></div>
    <div class="user-meta">
      <div class="name">{{ m.User.fullName || 'Kullanıcı' }}</div>
      <div class="sub">Kayıt Tarihi: {{ m.User.joinedAt | date:'d MMMM y' }}</div>
    </div>
  </div>

  <!-- === Etkinlik Başlığı === -->
  <h3 class="section-title">Etkinlik Başlığı</h3>
  <div class="panel">
    <input
      class="title-input"
      type="text"
      name="title0"
      [(ngModel)]="m.title"
      [attr.maxlength]="m.maxTitleLen"
      [attr.aria-invalid]="!m.title ? true : null"
      required
      placeholder="Etkinlik başlığını girin"
      aria-describedby="titleHelp titleCount"
      autocomplete="off"
    />
    <div id="titleCount" class="char-count">
      {{ (m.title || '').length }}/{{ m.maxTitleLen }}
    </div>
  </div>

  <!-- === Açıklama === -->
  <h3 class="section-title">Açıklama</h3>
  <div class="panel">
    <textarea
      class="desc-input"
      name="description0"
      [(ngModel)]="m.description"
      [attr.maxlength]="m.maxDescLen"
      rows="4"
      [attr.aria-invalid]="!m.description ? true : null"
      required
      placeholder="Etkinlik hakkında detaylı bilgi verin. Nerede, ne zaman, kimlerle, ne yapılacak?"
      aria-describedby="descHelp descCount"
    ></textarea>
  
    <div id="descCount" class="char-count">
      {{ (m.description || '').length }}/{{ m.maxDescLen }}
    </div>
  </div>

  <!-- === Tarih & Saat === -->
  <h3 class="section-title">Tarih & Saat</h3>
  <div class="panel date-time-panel">
    <!-- Tarih -->
    <mat-form-field appearance="outline" class="date-field">
      <mat-label>Tarih</mat-label>
      <input
        matInput
        name="date0"
        [matDatepicker]="picker"
        [(ngModel)]="m.selectedDate"
        [min]="m.minDate"
        placeholder="Tarih seçin"
        required
        autocomplete="off"
      />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker startView="multi-year" touchUi="true"></mat-datepicker>
    </mat-form-field>

    <!-- Saat -->
    <div class="time-select">
      <select
        id="time0"
        name="time0"
        [(ngModel)]="m.selectedTime"
        required
        autocomplete="off"
        [attr.aria-invalid]="!m.selectedTime ? true : null">
        <option [ngValue]="null" disabled> Saat </option>
        <option *ngFor="let t of m.times" [ngValue]="t" [disabled]="isPastTimeOnSelectedDate(t)">
          {{ t }}
        </option>
      </select>
    </div>
  </div>

  <!-- === Konum === -->
  <h3 class="section-title">Konum</h3>
  <div class="panel location-panel">

    <!-- Şehir -->
    <mat-form-field class="city-field" appearance="outline">
      <mat-label>Şehir</mat-label>
      <input
        matInput
        name="city0"
        placeholder="Örn: Ankara"
        [(ngModel)]="m.cityQuery"
        (ngModelChange)="onCityQueryInput($event)"
        [matAutocomplete]="cityAuto"
        [disabled]="!locationReady"
        required
        aria-autocomplete="list"
        autocomplete="off"
      />
      <mat-autocomplete
        #cityAuto="matAutocomplete"
        (optionSelected)="onCitySelected($event.option.value)">
        <mat-option *ngFor="let c of m.filteredCities" [value]="c">
          {{ c.name }}
        </mat-option>
        <mat-option *ngIf="m.filteredCities.length === 0" disabled>
          Sonuç yok
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- İlçe -->
    <mat-form-field class="district-field" appearance="outline">
      <mat-label>İlçe</mat-label>
      <input
        matInput
        name="district0"
        placeholder="İlçe yazın"
        [(ngModel)]="m.districtQuery"
        (ngModelChange)="onDistrictQueryInput($event)"
        [matAutocomplete]="districtAuto"
        [disabled]="!locationReady || !m.selectedCityId"
        required
        aria-autocomplete="list"
        autocomplete="off"
      />
      <mat-autocomplete
        #districtAuto="matAutocomplete"
        (optionSelected)="onDistrictSelected($event.option.value)">
        <mat-option *ngFor="let d of m.filteredDistricts" [value]="d">
          {{ d.name }}
        </mat-option>
        <mat-option *ngIf="m.selectedCityId && m.filteredDistricts.length === 0" disabled>
          Sonuç yok
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

  </div>

 <!-- === Buton === -->
<div class="actions">
  <!-- TEST: tıklanabilir mi? -->
<button
  class="ellipse-btn ellipse-btn--block"
  (click)="createListing()"
  [disabled]="false">
  Bul Beni
</button>

</div>

</div>
