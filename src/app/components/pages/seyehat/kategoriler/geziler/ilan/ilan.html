<!-- components/pages/seyehat/kategoriler/geziler/ilan/ilan.html -->
<div class="create-wrapper">

  <!-- ===== İlan Sahibi Bilgisi ===== -->
  <div class="user-bar" style="display:flex; align-items:center; margin-bottom:16px;">
    <div class="avatar"
         style="width:40px; height:40px; border-radius:50%; background:#6200ee; color:white;
                display:flex; align-items:center; justify-content:center; font-weight:bold; margin-right:12px;">
      {{ (ilanUser?.fullName || 'U') | slice:0:1 | uppercase }}

    </div>
    <div class="user-meta">
      <div class="name" style="font-weight:600; font-size:14px;">
        {{ ilanUser?.fullName || 'Kullanıcı Adı' }}
      </div>
      <div class="sub" style="font-size:12px; color:gray;">
       {{ (ilanUser?.joinedAt | date:'d MMM y') || 'Katılım tarihi yok' }}

      </div>
    </div>
  </div>

  <!-- ===== Başlık ===== -->
  <div class="pill">Etkinlik Başlığı</div>
  <div class="title-panel">
    <input class="title-input" type="text"
      [value]="title" [attr.maxlength]="maxTitleLen"
      placeholder="Etkinlik başlığını girin" aria-describedby="titleCount"
      [attr.aria-invalid]="titleInvalid"
      (blur)="titleTouched = true" (input)="onTitleChange($event)"
      [class.invalid]="titleInvalid" />
    <div id="titleCount" class="counter">{{ titleLen }}/{{ maxTitleLen }}</div>
    @if (titleInvalid) { <div class="error">Başlık zorunludur.</div> }
  </div>

  <!-- ===== Açıklama ===== -->
  <div class="pill" style="margin-top: 14px;">Açıklama</div>
  <div class="title-panel">
    <textarea class="title-input" rows="5"
      [value]="description" [attr.maxlength]="maxDescLen"
      placeholder="Etkinlik açıklamasını yazın" aria-describedby="descCount"
      [attr.aria-invalid]="descInvalid"
      (blur)="descriptionTouched = true" (input)="onDescChange($event)"
      [class.invalid]="descInvalid"></textarea>
    <div id="descCount" class="counter">{{ descLen }}/{{ maxDescLen }}</div>
    @if (descInvalid) { <div class="error">Açıklama zorunludur.</div> }
  </div>

  <!-- ===== Tarih & Saat ===== -->
  <div class="pill" style="margin-top: 14px;">Tarih &amp; Saat</div>
  <div class="title-panel">
    <div class="date-time-row">
      <select class="title-input" [value]="selectedYear ?? ''"
        (change)="onYearSelect( +$any($event.target).value )">
        <option value="">Yıl seç</option>
        @for (y of years; track y) { <option [value]="y">{{ y }}</option> }
      </select>

      <select class="title-input" [disabled]="!selectedYear"
        [value]="selectedMonth ?? ''"
        (change)="onMonthSelect( +$any($event.target).value )">
        <option value="">Ay seç</option>
        @for (m of months; track m.id) { <option [value]="m.id">{{ m.name }}</option> }
      </select>

      <select class="title-input" [disabled]="!selectedMonth"
        [value]="selectedDay ?? ''"
        (change)="onDaySelect( +$any($event.target).value )">
        <option value="">Gün seç</option>
        @for (d of days; track d) { <option [value]="d">{{ d }}</option> }
      </select>

      <select class="title-input hour-select"
        [value]="selectedHour ?? ''" (change)="onHourChange($event)">
        <option value="">Saat</option>
        @for (h of hours; track h) { <option [value]="h">{{ (h < 10 ? '0' + h : h) }}:00</option> }
      </select>
    </div>

    @if (eventDate) {
      <div class="hint">
        Seçilen: {{ eventDate }}
        {{ selectedHour !== null ? ((selectedHour! < 10 ? '0'+selectedHour : selectedHour) + ':00') : '' }}
      </div>
    }
  </div>

  <!-- ===== Konum (İl + İlçe yan yana) ===== -->
  <div class="pill" style="margin-top: 14px;">Konum</div>
  <div class="title-panel">
    <div class="location-row" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">

      <!-- İl sütunu -->
      <div style="position:relative;">
        <label class="field-label">İl</label>
        <input class="title-input city-input" type="text"
          [value]="citySearch" placeholder="İl ara veya seç"
          (focus)="onCityFocus()" (blur)="onCityBlur()" (input)="onCityInputChange($event)" />

        @if (showCityDropdown) {
          <ul class="dropdown">
            @if (loadingCities) {
              <li class="dropdown-item"><span class="hint">İller yükleniyor…</span></li>
            }
            @for (c of filteredCities; track c.id) {
              <li class="dropdown-item" (mousedown)="selectCity(c)">{{ c.name }}</li>
            }
            @if (!loadingCities && filteredCities.length === 0) {
              <li class="dropdown-item"><span class="hint">Eşleşen il yok.</span></li>
            }
          </ul>
        }
      </div>

      <!-- İlçe sütunu -->
      <div style="position:relative;">
        <label class="field-label">İlçe</label>
        <input class="title-input district-input" type="text"
          [value]="districtSearch" [disabled]="!selectedCityId"
          placeholder="{{ selectedCityId ? 'İlçe ara veya seç' : 'Önce il seçin' }}"
          (focus)="onDistrictFocus()" (blur)="onDistrictBlur()" (input)="onDistrictInputChange($event)" />

        @if (showDistrictDropdown) {
          <ul class="dropdown">
            @if (loadingDistricts) {
              <li class="dropdown-item"><span class="hint">İlçeler yükleniyor…</span></li>
            }
            @for (d of filteredDistricts; track d.id) {
              <li class="dropdown-item" (mousedown)="selectDistrict(d)">{{ d.name }}</li>
            }
            @if (!loadingDistricts && selectedCityId && filteredDistricts.length === 0) {
              <li class="dropdown-item"><span class="hint">Bu il için eşleşen ilçe yok.</span></li>
            }
          </ul>
        }
      </div>

    </div>

    @if (locationError) {
      <div class="error" style="margin-top:8px;">{{ locationError }}</div>
    }
  </div>

  <!-- ===== Submit ===== -->
  <div class="actions">
    <button type="button" class="primary-btn"
      (click)="onSubmit()"
      [disabled]="submitting || !formValid"
      aria-label="Bul Beni - ilanı kaydet">
      Bul Beni
    </button>
  </div>

<!-- ===== Sonuç / Hata ===== -->
<div class="status-area" aria-live="polite">
  @if (createdId) {
    <div class="celebrate" role="status">
      🎉 YOL ARKADAŞINI BULMAYA BİR ADIM DAHA YAKLAŞTIN! 😊
    </div>
    <div class="result" role="status">
      ✅ İlan oluşturuldu. ID: {{ createdId }}
    </div>
  }

  @if (submitError) {
    <div class="error" role="alert">❌ {{ submitError }}</div>
  }
</div>